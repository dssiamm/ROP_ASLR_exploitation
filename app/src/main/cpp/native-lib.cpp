#include <jni.h>
#include <string>

char canaries[4];
char payload[];

void find_canaries(char *ptr)
{
    for(int i = 0; i < 4; i++)
    {
        canaries[i] = *(ptr + i);
    }
}

JNIEXPORT void JNICALL
Java_com_example_dssiam_rop_1aslr_1exploitation_MainActivity_Exploitation(JNIEnv *env,
                                                                          jobject instance) {

    char buffer[2];
    char *end_of_buffer;

    end_of_buffer = (char *) buffer[3];

    memset(payload, 'A', 2);

    find_canaries(end_of_buffer);

    memcpy(&payload[2], canaries, 4);

    strcpy(buffer, payload);

}

JNIEXPORT void JNICALL
Java_com_example_dssiam_rop_1aslr_1exploitation_MainActivity_Attack(JNIEnv *env, jobject instance) {

    // TODO

}

extern "C"
JNIEXPORT jstring JNICALL
Java_com_example_dssiam_rop_1aslr_1exploitation_MainActivity_stringFromJNI(
        JNIEnv* env,
        jobject /* this */) {
    std::string hello = "Hello from C++";
    return env->NewStringUTF(hello.c_str());
}
